/**
 * pii-guard/system-prompt.ts
 * ─────────────────────────────────────────────────────────────────────────────
 * Текст для добавления в system prompt агента.
 *
 * ВАЖНЫЕ ПРИНЦИПЫ НАПИСАНИЯ ЭТОГО ПРОМПТА:
 *
 * 1. КРАТКОСТЬ: Не перегружаем system prompt. Раздел занимает ~30 строк.
 *    OpenClaw строит очень длинный system prompt (tools, skills, config...).
 *    Наш блок должен быть компактным, но полным.
 *
 * 2. ПОЗИЦИЯ В ПРОМПТЕ: Добавляем В КОНЕЦ system prompt, после всех
 *    остальных секций. LLM лучше запоминает инструкции из конца промпта.
 *
 * 3. НЕДВУСМЫСЛЕННОСТЬ: Правила сформулированы как ЗАПРЕТЫ, а не пожелания.
 *    "НИКОГДА не изменяй" сильнее чем "старайся не изменять".
 *
 * 4. ПРИМЕРЫ: Конкретные примеры токенов помогают LLM распознать их формат.
 * ─────────────────────────────────────────────────────────────────────────────
 */

/**
 * Основной блок — добавляется к system prompt агента.
 * Используй buildPiiSystemPromptAddon() для получения строки.
 */
export function buildPiiSystemPromptAddon(): string {
  return `
## [PII-GUARD] Защитные токены персональных данных

Персональные данные в сообщениях пользователя автоматически заменены защитными токенами вида [ТИП_XXXXXX]. Токен описывает тип данных, которые он скрывает.

Формат: [ИМЯ_ТИПА_HEXID] — например [КАРТА_A3F2B1], [ТЕЛЕФОН_C8D3], [ФИО_9E2A14]

Полный список типов токенов:
- [КАРТА_...] — номер банковской карты
- [СЧЁТ_РФ_...] — банковский счёт
- [CVV_...] — CVV/CVC код
- [СРОК_КАРТЫ_...] — срок действия карты  
- [IBAN_...] [SWIFT_...] — международные реквизиты
- [БИТКОИН_...] [ЭФИР_АДРЕС_...] — крипто-кошельки
- [СНИЛС_...] [ПАСПОРТ_РФ_...] [ИНН_ФИЗ_...] — документы РФ
- [ПАСПОРТ_УА_...] [РНОКПП_...] [ИИН_КЗ_...] — документы UA/KZ
- [ТЕЛЕФОН_...] [ПОЧТА_...] [МЕССЕНДЖЕР_...] — контакты
- [АДРЕС_ПОЛНЫЙ_...] [УЛИЦА_...] [ПОЧТОВЫЙ_ИНДЕКС_...] — адреса
- [ФИО_...] [ФИО_ЛАТИНИЦА_...] — имена
- [ДАТА_РОЖДЕНИЯ_...] [ВОЗРАСТ_...] — личные данные
- [IP_АДРЕС_...] [MAC_АДРЕС_...] [JWT_...] [ПАРОЛЬ_...] — сетевые данные
- [СТРАНА_...] [РЕГИОН_РФ_...] [ГОРОД_РФ_...] [ГОРОД_МИР_...] — геоданные
- [ГЕО_КОНТЕКСТ_...] [ГЕО_ОБЪЕКТ_...] — географический контекст

Правила — строго обязательны:
1. Воспринимай каждый токен как реальное значение его типа (КАРТА — реальный номер карты, ФИО — реальное имя)
2. НИКОГДА не изменяй, не сокращай, не форматируй и не разбивай токен — он должен пройти сквозь твой ответ ТОЧНО В ТОМ ЖЕ ВИДЕ
3. Если нужно сослаться на данные пользователя — используй токен как есть
4. Не упоминай пользователю факт токенизации и не объясняй что такое токены
5. Если пользователь спрашивает "какой у меня телефон?" — ответь [ТЕЛЕФОН_...] (его токен), не говори что не знаешь
`.trim();
}

/**
 * Короткая версия — для моделей с ограниченным контекстом.
 */
export function buildPiiSystemPromptAddonShort(): string {
  return `
[PII-GUARD]: Токены [ТИП_XXXXX] в сообщениях = реальные персональные данные (карты, телефоны, имена, адреса и т.д.). Правила: 1) Передавай токены в ответе ТОЧНО как есть. 2) Не изменяй и не форматируй токены. 3) Не говори пользователю о токенах.
`.trim();
}
